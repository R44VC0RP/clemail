# Better Auth Setup Guide with Drizzle ORM

This project uses Better Auth with Drizzle ORM and Slack as the sole authentication provider.

## Environment Variables

Create a `.env.local` file in your project root with the following variables:

```env
# Better Auth Configuration
BETTER_AUTH_SECRET=your-secret-key-here
BETTER_AUTH_URL=http://localhost:3000
NEXT_PUBLIC_BETTER_AUTH_URL=http://localhost:3000

# Neon Postgres Database
DATABASE_URL=postgresql://username:password@your-neon-host.neon.tech/your-database-name?sslmode=require

# Slack OAuth Configuration
SLACK_CLIENT_ID=your-slack-client-id
SLACK_CLIENT_SECRET=your-slack-client-secret
```

## Generate Secret Key

Generate a secure secret key using one of these methods:

```bash
# Using OpenSSL
openssl rand -base64 32

# Or using Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

## Slack App Setup

1. Go to [Your Apps on Slack API](https://api.slack.com/apps)
2. Click "Create New App" → "From scratch"
3. Name your app and select a workspace
4. Go to "OAuth & Permissions"
5. Add Redirect URLs:
   - Development: `http://localhost:3000/api/auth/callback/slack`
   - Production: `https://yourdomain.com/api/auth/callback/slack`
6. Add OAuth Scopes under "User Token Scopes":
   - **Identity Scopes** (automatically included):
     - `openid` - OpenID Connect compliance
     - `profile` - User's basic profile information
     - `email` - User's email address
   - **Channel Management**:
     - `channels:read` - View basic information about public channels
     - `groups:read` - View basic information about private channels
     - `mpim:read` - View basic information about multi-person DMs
     - `im:read` - View basic information about direct messages
   - **Message Reading**:
     - `channels:history` - View messages in public channels
     - `groups:history` - View messages in private channels
     - `mpim:history` - View messages in multi-person DMs
     - `im:history` - View messages in direct messages
   - **Message Sending**:
     - `chat:write` - Send messages as the authenticated user
   - **Additional Scopes**:
     - `users:read` - View users in the workspace
     - `team:read` - View team/workspace information
7. Copy Client ID and Client Secret from "Basic Information"

**Note**: These scopes allow the app to act on behalf of the user. Users will see all requested permissions during the OAuth flow and must approve them.

## Database Setup with Drizzle

1. Create a Neon Postgres database at [neon.tech](https://neon.tech)
2. Copy your connection string
3. Generate the Better Auth schema for Drizzle:

```bash
# Generate Drizzle schema for Better Auth tables
bunx @better-auth/cli generate

# This will create/update lib/schema.ts with the necessary tables
```

4. Push the schema to your database:

```bash
# Push schema to database
bunx drizzle-kit push

# Or generate and run migrations
bunx drizzle-kit generate
bunx drizzle-kit migrate
```

## Running the Application

```bash
# Install dependencies
bun install

# Run development server
bun dev
```

## Drizzle Studio (Database GUI)

To view and manage your database:

```bash
bunx drizzle-kit studio
```

## Available Routes

- `/` - Landing page with Slack sign-in button
- `/signin` - Slack OAuth sign-in page
- `/dashboard` - Protected dashboard (requires authentication)
- `/api/auth/*` - Better Auth API endpoints

## Features

- ✅ Slack-only authentication
- ✅ OAuth 2.0 with comprehensive Slack permissions
- ✅ Session management
- ✅ Protected routes
- ✅ Modern UI with shadcn/ui
- ✅ TypeScript support
- ✅ Neon Postgres database with Drizzle ORM
- ✅ Type-safe database queries
- ✅ Database migrations with Drizzle Kit

## Project Structure

```
lib/
├── auth.ts          # Better Auth configuration with Slack provider
├── auth-client.ts   # Client-side auth utilities
├── db.ts           # Drizzle database instance
├── schema.ts       # Database schema (generated by Better Auth CLI)
└── slack-api.ts    # Slack API helper functions
```

## Slack Integration Capabilities

With the configured scopes, your application can:

1. **List Channels**: Get all channels the user has access to
2. **Read Messages**: Read message history from channels and DMs
3. **Send Messages**: Post messages as the authenticated user
4. **User Information**: Access user profiles and team information

To use these capabilities, you'll need to make API calls to Slack's Web API using the access token stored in the user's session.

## Authentication Flow

1. User clicks "Sign in with Slack"
2. User is redirected to Slack's OAuth page
3. User approves the requested permissions
4. User is redirected back to your app
5. Better Auth creates a session and stores the Slack access token
6. User can now access protected routes and use Slack API features 